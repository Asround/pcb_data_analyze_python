# 读取表格代码说明

## 表格类型

- 截止 2025 年 2 月 12 日, 进行了 8 次数据测试. 由于存储数据规范不统一, 导致出现了以下几种表格:
  1. 复制粘贴型 .xlsx 表格 ( 后简称 "1.型表格" )
     - 数据在 B3 - C503 单元格 (501数据点情况下)
  2. 软件导出型 .xlsx 表格 ( 后简称 "2.型表格" )
     - 数据在 C36 - D536 单元格 (501数据点情况下)
  3. 软件导出型 .csv  表格 ( 后简称 "3.型表格" ) ==> 可通过代码另存为 .xlsx 表格
     - 数据在 C36 - D536 单元格 (501数据点情况下)

- "3. 软件导出型 .csv 表格" 可以通过Excel自带指令批量另存为 .xlsx 表格. 并且其电压电流数据存储的单元格位置和 "2. 软件导出型 .xlsx 表格" 一致. 所以可以使用同样的代码读取其数据. 
- "1. 复制粘贴型 .xlsx 表格" 的数据存储单元格位置与另外两者有区别. 所以需要使用稍有差别的代码读取其数据.

## 读取表格内容

- 目前代码用 `if` 语句自动判断表格类型是 1. 还是2. / 3. (只分两类是因为读取时, 2. 3. 读取方式一致)

  ```python
  # 读取 Excel 文件到 pd 中
  xls = pd.ExcelFile(file_path)
  df = xls.parse(sheet_name=0)
  
  # 提取 .xlsx表格中 B2 单元格的内容到 B2 变量中
  # # B2内容有两种情况: 
  # # (1) "1.型表格":电压 (V); (2)"2/3.型表格": 500、501或其他数字 （表示数据点数）
  B2 = df.iloc[0,1] # '.iloc[0,1]': 取表格索引为[0,1]单元格(即B2)的内容
      if 'V' in B2: # 满足该条件, 即 "1.型表格"
          B2 = False
      else: # 即"2/3.型表格"
          B2 = int(df.iloc[0, 1]) # 将 B2 强制转换为int类型, 作用和 B2 = True 相同
  
  # if 判断实现不同文件分类读取
  if B2 : 
      # "2/3.型表格"是非零数字(真), 满足 if 条件 则读取 C36 到 D536 的数据
      df_filtered = df.iloc[34:34 + B2 - 1, [2, 3]].dropna()  
      # [34: 34 + B2 - 1,[2,3]]对应 C36 到 D536
      # 34 对应 36 是因为自动丢弃第一行, 并且从 0 开始索引
      # 2 对应 C 是因为 0 是开始索引, 对应 A
      # [34 + B2 - 1, 3] 即 D(B2+33)单元格, 数学上易知是最后一个电流对应单元格
      # # 这样规定的原因是, "2.型表格" 的电压电流数据后有统计量, 不希望它们被读入
  
  else:
      # "1.型表格" 是False(假), ，则读取 B3 到 C503 的数据
      df_filtered = df.iloc[1:501, [1, 2]].dropna()
      # [501,2]对应 C503, 相当于我们默认读取 501 组数据
      # 因为"1.型表格" 的电压电流数据后面是空值, 会被 .dropna(丢弃), 不怕多读.
  
  # 重新命名列名 (左边是电压, 右边是电流)
  df_filtered.columns = ["电压 (V)", "电流 (A)"]
  
  # 转换数据为数值类型（防止字符串干扰）,方便绘图和后续曲线拟合
  df_filtered = df_filtered.astype(float)
  
  # 提取自变量（电压）和因变量（电流）
  x = df_filtered["电压 (V)"]
  y = df_filtered["电流 (A)"]

## 其他说明

1.  .csv 如何转 .xlsx 详见对应文档, 有十分详细的说明和代码.
2.  .csv文件转换的 .xlsx 文件和直接导出的 .xlsx 文件有细微区别
   - 前者在电压电流数据后无统计量内容
   - 两者在前 34 行中部分单元格中内容的格式有差异(这在我写代码时曾带来一定的麻烦)
3. 以后请务必<font size =4 color=red>**统一2470仪器设置, 统一导出规范!**</font>否则会对代码编写造成很多麻烦.
   - 个人推荐:
     1. 0 ~ 1000V, 501数据点, 其他不动
     2. 导出请选择 .xlsx 格式, 每次点击 "导出当前运行" 而不是所有运行.

---

- 旧的判断方式无法正确对 csv 转 xlsx 文件进行分类, 故已经采用了新的判断方式.